# Анализ проблем и план исправлений

## Критические проблемы (блокирующие работу)

1. **Отсутствует litellm** (блокирует LLM)
   - Ошибка: `[ERROR] Ошибка OpenRouter: litellm недоступен`
   - Причина: Не установлен пакет `litellm` в окружении бэкенда
   - Фикс: `pip install litellm`

2. **RAG отключен из-за отсутствия txtai**
   - Ошибка: `[ERROR] Worker init failed: {'ok': False, 'error': 'txtai not available in worker env'}`
   - Причина: Не установлен пакет `txtai[faiss]` в окружении бэкенда
   - Фикс: `pip install "txtai[faiss]"`

3. **Проблема с портом 5051**
   - Ошибка: `Port 5051 is in use by another program`
   - Причина: Несколько экземпляров бэкенда пытаются использовать один порт
   - Фикс: Убить старые процессы и перезапустить

## Важные проблемы (влияют на функциональность)

4. **Проблемы с интеграцией CrewAI**
   - Ошибка: `[WARNING] CrewAI не доступен. Интеграция с агентами будет ограничена.`
   - Причина: Проблема с импортом или инициализацией CrewAI
   - Фикс: Проверить установку CrewAI и пути импорта

5. **Проблемы с инструментами**
   - Ошибка: `[WARNING] [WARNING] Не удалось инициализировать CrewAI инструменты: 'CrewAIToolsIntegrator' object has no attribute 'get_available_tools'`
   - Причина: Несоответствие версий или проблемный код интеграции
   - Фикс: Обновить интеграцию с CrewAI

## Второстепенные проблемы

6. **Отсутствует spaCy**
   - Ошибка: `[WARNING] ⚠️ Не удалось загрузить spaCy или языковые модели: No module named 'spacy'`
   - Влияние: Отключен эмоциональный классификатор
   - Фикс: `pip install spacy`

7. **Проблемы с путями Windows**
   - Ошибка: `⚠️ Путь к tools не найден: c:\Users\crazy\GOPI_AI_MODULES/GopiAI-CrewAI/tools`
   - Причина: Жестко закодированные пути Windows
   - Фикс: Обновить пути для кроссплатформенной совместимости

## Рекомендуемый порядок исправлений

1. **Установить недостающие зависимости**:
   ```bash
   # В окружении бэкенда
   pip install litellm "txtai[faiss]" spacy
   ```

2. **Остановить все процессы бэкенда**:
   ```bash
   pkill -f "python.*crewai_api_server.py"
   ```

3. **Запустить бэкенд заново**:
   ```bash
   cd /home/amritagopi/GopiAI/GopiAI-CrewAI
   python crewai_api_server.py
   ```

4. **Проверить работоспособность API**:
   ```bash
   curl http://127.0.0.1:5051/api/health
   ```

5. **После успешного запуска бэкенда** обновить зависимости UI:
   ```bash
   cd /home/amritagopi/GopiAI/GopiAI-UI
   pip install -r requirements.txt
   ```

6. **Запустить UI**:
   ```bash
   python main.py
   ```

## Дополнительные рекомендации

1. Добавить проверку зависимостей при старте приложения
2. Реализовать автоматическую установку недостающих пакетов
3. Добавить логирование ошибок в отдельный файл для удобства отладки
