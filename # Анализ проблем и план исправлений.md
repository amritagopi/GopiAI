# Анализ проблем и план исправлений

## Критические проблемы (блокирующие работу)

1. **Порт 5051 занят**
   - Лог: `Port 5051 is in use by another program` в `GopiAI-CrewAI/logs/backend.log`
   - Причина: параллельно запущено несколько экземпляров бэкенда
   - Фикс:
     - Остановить лишние процессы: `pkill -f "python.*crewai_api_server.py"`
     - Проверить, кто держит порт: `lsof -i :5051` (если установлено)
     - Перезапустить один экземпляр бэкенда

## Важные проблемы (влияют на функциональность)

2. **CrewAI недоступен / ограниченная интеграция**
   - Логи: `[WARNING] CrewAI не доступен. Интеграция с агентами будет ограничена.`
   - Причина: модуль `crewai` не установлен/недоступен в среде или ошибки инициализации
   - Фикс: убедиться, что пакет `crewai` установлен в окружении бэкенда и корректно подключается в `crewai_api_server.py`

3. **Ошибка инициализации CrewAI Tools Integrator**
   - Лог: `[WARNING] Не удалось инициализировать CrewAI инструменты: 'CrewAIToolsIntegrator' object has no attribute 'get_available_tools'`
   - Причина: несовместимость API/версий интегратора с текущим кодом
   - Фикс: синхронизировать интерфейс интегратора и вызовы (реализовать/переименовать `get_available_tools` или скорректировать обращение)

4. **UI: не найден модуль интеграции ModelProvider (fallback)**
   - Лог запуска UI: `Could not import ModelProvider from backend, using fallback. Error: No module named 'gopiai_integration'`
   - Причина: модуль `gopiai_integration` вне `PYTHONPATH`/не собран/не установлен
   - Фикс: проверить наличие каталога `GopiAI-CrewAI/tools/gopiai_integration` и его добавление в `sys.path` при старте UI/бэкенда

## Второстепенные проблемы

5. **Проблемы с путями Windows**
   - Ошибка: `Путь к tools не найден: c:\Users\crazy\GOPI_AI_MODULES/GopiAI-CrewAI/tools`
   - Причина: Жестко закодированные пути Windows
   - Фикс: Обновить пути для кроссплатформенной совместимости

## Рекомендуемый порядок исправлений

1. **Разблокировать порт и оставить один бэкенд**
   ```bash
   pkill -f "python.*crewai_api_server.py" || true
   # опционально: lsof -i :5051
   cd /home/amritagopi/GopiAI/GopiAI-CrewAI
   python crewai_api_server.py
   ```

2. **Проверить здоровье API**
   ```bash
   curl http://127.0.0.1:5051/api/health
   ```

3. **Починить CrewAI и интегратор инструментов**
   - Установить/проверить `crewai` в окружении бэкенда.
   - Привести в соответствие методы интегратора (реализовать `get_available_tools` или обновить вызовы).

4. **Починить импорт `gopiai_integration` для UI**
   - Убедиться, что путь `GopiAI-CrewAI/tools` добавлен в `sys.path` UI.
   - Проверить наличие пакета/модуля `gopiai_integration` и корректных путей.

5. **Унифицировать пути (Windows/Linux)**
   - Убрать хардкоды Windows-путей, использовать `os.path`/`pathlib`.

## Дополнительные рекомендации

1. Добавить проверку зависимостей при старте приложения
2. Реализовать автоматическую установку недостающих пакетов
3. Добавить логирование ошибок в отдельный файл для удобства отладки
