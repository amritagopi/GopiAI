# Анализ текущей системы агентов

## Структура системы агентов
1. **AgentManager** (`app/agent/agent_manager.py`) - синглтон для управления агентами
   - Создает и управляет экземплярами различных типов агентов
   - Предоставляет методы для получения агентов по идентификатору
   - Обеспечивает создание агента по умолчанию

2. **BaseAgent** (`app/agent/base.py`) - абстрактный базовый класс для всех агентов
   - Реализует интерфейс IAgent
   - Предоставляет базовую функциональность для управления состоянием и памятью агента
   - Включает методы для установки LLM, провайдеров инструментов и промптов
   - Абстрактный метод step() должен быть реализован в подклассах

3. **Manus** (`app/agent/manus.py`) - агент общего назначения
   - Наследуется от BrowserAgent
   - Включает набор инструментов для различных задач

4. **CodingAgent** (`app/agent/coding_agent.py`) - специализированный агент для работы с кодом
   - Наследуется от ToolCallAgent
   - Поддерживает работу с редактором кода и инструментами разработки
   - Отслеживает состояние редактора для контекста

## Интеграция с UI
1. **Основной агент** (`app/logic/agent_setup.py`)
   - Создается при инициализации главного окна
   - Использует AgentManager для получения экземпляра агента
   - Подключается к интерфейсу через AgentWorker

2. **AgentWorker** (`app/logic/agent_worker.py`)
   - Запускает задачи агента в отдельном потоке
   - Отправляет сигналы о статусе и результатах работы агента

3. **CodingAgentInterface** (`app/ui/coding_agent_interface.py`)
   - Интерфейс для взаимодействия с агентом кодирования
   - Запускает CodingAgentWorker в отдельном потоке
   - Обрабатывает запросы пользователя и код из редактора

4. **CodingAgentDialog** (`app/ui/coding_agent_dialog.py`)
   - Отдельное окно для работы с агентом кодирования
   - Включает редактор кода и интерфейс чата
   - Поддерживает отправку кода из редактора в чат и наоборот

## Проблемы текущей реализации
1. **Отсутствие единого подхода к управлению агентами**
   - Основной агент создается в MainWindow через функцию setup_agent
   - CodingAgent создается напрямую в CodingAgentInterface
   - Нет единой точки для управления всеми активными агентами

2. **Дублирование кода для работы с агентами**
   - Похожий код для создания рабочих потоков в AgentWorker и CodingAgentWorker
   - Отдельные реализации обработки сообщений агента

3. **Отсутствие централизованного механизма обмена данными между агентами**
   - Агенты работают независимо и не могут обмениваться контекстом
   - Нет механизма совместного использования инструментов или LLM

4. **Отсутствие единого интерфейса для взаимодействия UI с агентами**
   - Каждый компонент UI напрямую взаимодействует с агентами
   - Нет унифицированного API для отправки запросов и получения ответов

## Преимущества централизованного управления агентами
1. **Единая точка доступа к агентам**
   - Все компоненты UI будут взаимодействовать с агентами через единый интерфейс
   - Упрощение создания, настройки и получения экземпляров агентов

2. **Управление жизненным циклом агентов**
   - Централизованное создание и уничтожение агентов
   - Отслеживание активных агентов и их состояния

3. **Совместное использование ресурсов**
   - Общий доступ к LLM, инструментам и другим ресурсам
   - Возможность переиспользования контекста между агентами

4. **Простота масштабирования**
   - Легкое добавление новых типов агентов
   - Поддержка сложных сценариев с несколькими взаимодействующими агентами