# Интеграция Reasoning Agent в GopiAI

## Обзор

Reasoning Agent - это интеллектуальный агент, который интегрирует возможности Serena и Sequential Thinking для решения сложных задач через системное рассуждение и анализ. Он работает по принципу "План → Разрешение → Выполнение", требуя явного одобрения плана перед выполнением действий.

## Архитектура

Интеграция Reasoning Agent состоит из следующих компонентов:

1. **Модуль ReasoningAgent** (`app/agent/reasoning.py`) - основной класс агента, расширяющий MCPAgent.
2. **Система разрешений** (`app/agent/permission_manager.py`) - контролирует доступ к инструментам и проверяет безопасность операций.
3. **Модули доступа к ресурсам**:
   - `app/agent/terminal_access.py` - безопасный доступ к терминалу
   - `app/agent/file_system_access.py` - безопасный доступ к файловой системе
   - `app/agent/browser_access.py` - безопасный доступ к браузеру
4. **Интерфейс пользователя**:
   - `app/ui/reasoning_agent_dialog.py` - диалог для взаимодействия с агентом
   - `app/ui/reasoning_settings_dialog.py` - диалог настроек Reasoning Agent
5. **Промпты и конфигурация**:
   - `app/prompt/reasoning.py` - системные промпты для Reasoning Agent
   - `app/config/reasoning_config.py` - конфигурация настроек рассуждений

## Принцип работы

### 1. Создание плана

Первый этап работы с Reasoning Agent - создание плана. Агент использует Sequential Thinking для анализа задачи и разработки пошагового плана действий. План включает:

- Анализ задачи и ее разбиение на шаги
- Определение необходимых инструментов
- Выявление потенциальных рисков и способов их смягчения
- Обоснование выбранного подхода

### 2. Одобрение плана

После создания плана, агент запрашивает явное одобрение пользователя. До получения одобрения агент не может использовать инструменты, которые модифицируют систему (редактирование файлов, выполнение команд терминала и т.д.).

### 3. Выполнение плана

После одобрения плана агент получает разрешение на использование инструментов с более высоким уровнем доступа и приступает к выполнению плана. На этом этапе пользователь может вводить запросы, которые будут выполняться в контексте одобренного плана.

## Безопасность и разрешения

Система разрешений использует четыре уровня доступа:
- **LOW** - безопасные действия (поиск, чтение файлов), доступны всегда
- **MEDIUM** - действия с умеренным риском (редактирование файлов, запуск команд), требуют одобрения плана
- **HIGH** - потенциально опасные действия (удаление файлов), требуют особых проверок
- **ADMIN** - административные действия, требуют явного разрешения

Система обеспечивает:
- Защиту от случайного удаления важных файлов
- Ограничение доступа к чувствительным директориям
- Логирование всех операций для аудита
- Контроль над выполнением потенциально опасных действий

## Настройки рассуждений

Диалог настроек Reasoning Agent позволяет гибко настроить работу агента:

- **Глубина рассуждений** - количество шагов в цепочке рассуждений (от 3 до 15)
- **Стратегия рассуждений** - способ построения цепочки мыслей:
  - Последовательная - линейный анализ шаг за шагом
  - Древовидная - исследование альтернативных путей
  - Адаптивная - изменение стратегии в зависимости от задачи
- **Безопасность** - включение/отключение проверок безопасности операций
- **Интерактивный режим** - требование подтверждения для каждого шага плана
- **Мониторинг** - отслеживание выполнения плана с визуализацией прогресса
- **Таймаут операций** - максимальное время выполнения операции

## Интеграция с MCP

Reasoning Agent интегрируется с MCP (Model Context Protocol) для работы с инструментами Serena и Sequential Thinking:

1. **Sequential Thinking** используется для создания цепочек рассуждений при планировании и выполнении задач.
2. **Serena** предоставляет доступ к файловой системе, выполнению команд терминала и другим инструментам.

## Интеграция с UI

Интеграция с пользовательским интерфейсом реализована через:

1. **Пункт меню Tools → Reasoning Agent** - открывает диалог работы с агентом
2. **Пункт меню Tools → Reasoning Settings** - открывает диалог настроек рассуждений

## Пример использования

```python
# Инициализация Reasoning Agent
from app.agent.reasoning import ReasoningAgent

agent = ReasoningAgent()
await agent.initialize(connection_type="stdio")

# Создание плана
plan = await agent.create_plan("Создать файл hello.py, выводящий приветствие")

# Одобрение плана
agent.approve_plan()

# Выполнение запроса в контексте плана
result = await agent.run("Реализуй функцию вывода приветствия")
```

## Техническое обслуживание

Для поддержки и расширения Reasoning Agent рекомендуется:

1. Добавлять новые инструменты в систему разрешений, указывая их уровень доступа.
2. Расширять модули доступа к ресурсам при необходимости новой функциональности.
3. Улучшать промпты для повышения качества рассуждений и планирования.
4. Добавлять новые стратегии рассуждений при необходимости.

## Дальнейшее развитие

Планируемые улучшения Reasoning Agent:
- Интеграция с графом знаний для долгосрочного хранения рассуждений
- Расширение стратегий рассуждений с поддержкой многоагентного подхода
- Улучшение детектирования и предотвращения рисков в планах
- Визуализация цепочек рассуждений для лучшего понимания пользователем
- Расширение API для программного доступа к возможностям Reasoning Agent
