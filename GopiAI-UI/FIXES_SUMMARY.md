# Исправления TabDocumentWidget

## Проблемы и решения

### 1. ❌ Краш при создании новой заметки
**Проблема**: Приложение крашилось при попытке создать новую заметку через `add_notebook_tab()`

**Решение**:
- Добавлена проверка доступности `NotebookEditorWidget` через флаг `NOTEBOOK_EDITOR_AVAILABLE`
- Добавлен try-catch блок с fallback к обычному `QTextEdit`
- Улучшено логирование ошибок
- Fallback редактор поддерживает форматирование (`setAcceptRichText(True)`)

### 2. ❌ Проблема с "закрыть все вкладки"
**Проблема**: Контекстное меню "закрыть все вкладки" не работало корректно

**Решение**:
- Добавлена защита от бесконечных циклов (максимум 100 итераций)
- Улучшена логика закрытия вкладок во всех методах:
  - `_close_all_tabs()`
  - `_close_other_tabs()`
  - `_close_tabs_to_left()`
  - `_close_tabs_to_right()`
- Добавлены проверки границ индексов

### 3. ✅ Фоновое изображение
**Добавлено**: Красивое фоновое изображение когда нет вкладок

**Функции**:
- Автоматическое масштабирование при изменении размера окна
- Умное переключение между фоном и вкладками
- Поддержка fallback заглушки при отсутствии изображения

## Технические улучшения

### Безопасность импортов
```python
try:
    from gopiai.ui.components.rich_text_notebook_widget import NotebookEditorWidget
    NOTEBOOK_EDITOR_AVAILABLE = True
except ImportError:
    NotebookEditorWidget = None
    NOTEBOOK_EDITOR_AVAILABLE = False
```

### Защита от бесконечных циклов
```python
def _close_all_tabs(self):
    max_iterations = 100
    iteration = 0
    while self.count() > 0 and iteration < max_iterations:
        self.removeTab(0)
        iteration += 1
```

### Fallback механизм
```python
except Exception as e:
    logger.error(f"Ошибка создания блокнота: {e}", exc_info=True)
    fallback_editor = QTextEdit()
    fallback_editor.setAcceptRichText(True)
    # ... создание fallback вкладки
```

## Результат

✅ **Стабильность**: Приложение больше не крашится при создании заметок
✅ **Функциональность**: Все опции контекстного меню работают корректно  
✅ **UX**: Красивое фоновое изображение улучшает пользовательский опыт
✅ **Надежность**: Добавлены fallback механизмы для всех критических операций

## Тестирование

Для проверки исправлений:
1. Запустите приложение
2. Попробуйте создать новую заметку (не должно крашиться)
3. Создайте несколько вкладок
4. ПКМ по вкладке → "Закрыть все вкладки" (должно показать фон)
5. Измените размер окна (фон должен масштабироваться)