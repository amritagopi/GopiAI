# Решение проблемы циклических импортов в модулях UI

## Описание проблемы

В проекте GopiAI была обнаружена циклическая зависимость между модулями:

1. `app/logic/agent_setup.py` - импортировал функции и константы из `app/ui/agent_ui_integration.py`
2. `app/ui/docks.py` - импортировал функцию `handle_user_message` из `app/logic/agent_setup.py`
3. `app/ui/agent_ui_integration.py` - использовал компоненты, которые зависели от `app/logic/agent_setup.py`

Это приводило к ошибке при запуске:
```
ERROR:app.ui.agent_ui_integration:Error connecting editor and chat signals: 'PySide6.QtCore.Signal' object has no attribute 'connect'
```

## Решение

Решение состояло из следующих шагов:

1. **Перемещение констант:**
   - Константы `MAIN_CHAT_COMPONENT_ID`, `CODING_AGENT_COMPONENT_ID`, `BROWSER_COMPONENT_ID` были определены непосредственно в `app/ui/agent_ui_integration.py` вместо импорта из `agent_setup.py`
   - В `agent_setup.py` теперь эти константы импортируются из `agent_ui_integration.py`

2. **Изменение импортов в docks.py:**
   - Импорт `handle_user_message` был перемещен из уровня модуля в место, где эта функция фактически используется (внутрь функции `create_docks`)
   - Это позволило избежать циклического импорта на этапе загрузки модулей

3. **Обновление комментариев:**
   - Обновлены комментарии, объясняющие новое расположение констант

## Рекомендации по предотвращению циклических импортов

1. **Разделение ответственности модулей:**
   - Функции и константы следует размещать в модулях, которые находятся ниже в иерархии зависимостей
   - Базовые компоненты не должны зависеть от компонентов более высокого уровня

2. **Техники отложенного импорта:**
   - Использование локальных импортов внутри функций вместо импортов на уровне модуля
   - Применение функционального подхода вместо прямой зависимости от классов

3. **Создание модулей-посредников:**
   - При необходимости создавать отдельные модули для хранения констант и базовых типов
   - Использовать паттерн "Посредник" для обмена данными между модулями

4. **Инверсия зависимостей:**
   - Использование абстракций (интерфейсов) вместо прямых зависимостей между модулями
   - Передача зависимостей в виде аргументов функций вместо импорта

5. **Мониторинг:**
   - Регулярно проверять структуру зависимостей в проекте
   - При добавлении новых зависимостей проверять отсутствие циклов

## Пример правильного импорта

В файле `app/ui/coding_agent_interface.py`:
```python
from app.ui.agent_ui_integration import CODING_AGENT_COMPONENT_ID
```

В файле `app/ui/docks.py`:
```python
def create_docks(main_window: QMainWindow):
    # ...
    from app.logic.agent_setup import handle_user_message
    main_window.chat_widget.message_sent.connect(lambda msg: handle_user_message(main_window, msg))
    # ...
```
